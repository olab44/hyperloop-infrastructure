DELIMITER

CREATE TRIGGER update_infrastructure_to_broken
AFTER UPDATE ON INFRASTRUCTURE_ELEMENT
FOR EACH ROW
BEGIN
    IF NEW.STATUS = 'B' AND OLD.STATUS != 'B' THEN
        INSERT INTO MALFUNCTION (`ELEMENT_FK`, `MALFUNCTION_DATE`, `STATUS`)
        VALUES (NEW.ELEMENT_ID, NOW(), NEW.STATUS);
    END IF;
END//

CREATE TRIGGER update_infrastructure_to_working
AFTER UPDATE ON INFRASTRUCTURE_ELEMENT
FOR EACH ROW
BEGIN
    IF NEW.STATUS = 'A' AND OLD.STATUS != 'A' THEN
        UPDATE MALFUNCTION
        SET REPAIR_DATE = NOW(), STATUS = 'A'
        WHERE ELEMENT_FK = NEW.ELEMENT_ID AND REPAIR_DATE IS NULL;
    END IF;
END //

DELIMITER ;