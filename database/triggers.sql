DELIMITER //

CREATE TRIGGER update_infrastructure_to_broken
AFTER UPDATE ON INFRASTRUCTURE_ELEMENT
FOR EACH ROW
BEGIN
    IF NEW.STATUS = 'M' AND OLD.STATUS != 'M' THEN
        INSERT INTO MALFUNCTION (`ELEMENT_FK`, `MALFUNCTION_DATE`, `STATUS`)
        VALUES (NEW.ELEMENT_ID, NOW(), NEW.STATUS);
    END IF;
END //

CREATE TRIGGER update_infrastructure_to_working
AFTER UPDATE ON INFRASTRUCTURE_ELEMENT
FOR EACH ROW
BEGIN
    IF NEW.STATUS = 'F' AND OLD.STATUS != 'F' THEN
        UPDATE MALFUNCTION
        SET REPAIR_DATE = NOW(), STATUS = 'F'
        WHERE ELEMENT_FK = NEW.ELEMENT_ID AND REPAIR_DATE IS NULL;
    END IF;
END //

DELIMITER ;