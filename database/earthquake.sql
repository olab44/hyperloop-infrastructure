-- earthquake simuation

DROP PROCEDURE SimulateEarthquake;
DELIMITER //
CREATE PROCEDURE SimulateEarthquake()
BEGIN
    DECLARE x1 FLOAT DEFAULT 52.603418;
    DECLARE y1 FLOAT DEFAULT 16.497074;
    DECLARE x2 FLOAT DEFAULT 52.185535;
    DECLARE y2 FLOAT DEFAULT 19.844095;
    DECLARE x3 FLOAT DEFAULT 51.498013;
    DECLARE y3 FLOAT DEFAULT 16.591235;
    DECLARE x4 FLOAT DEFAULT 51.487353;
    DECLARE y4 FLOAT DEFAULT 18.534391;

    UPDATE `INFRASTRUCTURE_ELEMENT`
    SET `STATUS` = 'M'
    WHERE `LATITUDE` BETWEEN LEAST(x1, x2, x3, x4) AND GREATEST(x1, x2, x3, x4)
      AND `LONGITUDE` BETWEEN LEAST(y1, y2, y3, y4) AND GREATEST(y1, y2, y3, y4);
END //

DELIMITER ;


-- repair
DROP PROCEDURE RepairElements;
DELIMITER //
CREATE PROCEDURE RepairElements()
BEGIN
    DECLARE x1 FLOAT DEFAULT 52.603418;
    DECLARE y1 FLOAT DEFAULT 16.497074;
    DECLARE x2 FLOAT DEFAULT 52.185535;
    DECLARE y2 FLOAT DEFAULT 19.844095;
    DECLARE x3 FLOAT DEFAULT 51.498013;
    DECLARE y3 FLOAT DEFAULT 16.591235;
    DECLARE x4 FLOAT DEFAULT 51.487353;
    DECLARE y4 FLOAT DEFAULT 18.534391;

    UPDATE `INFRASTRUCTURE_ELEMENT`
    SET `STATUS` = 'F'
    WHERE `STATUS` = 'M'
      AND `LATITUDE` BETWEEN LEAST(x1, x2, x3, x4) AND GREATEST(x1, x2, x3, x4)
      AND `LONGITUDE` BETWEEN LEAST(y1, y2, y3, y4) AND GREATEST(y1, y2, y3, y4);
END //

DELIMITER ;


CALL SimulateEarthquake();
CALL RepairElements();
